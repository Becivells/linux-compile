# gcc编译代码的过程


## 预处理
预处理主要完成的工作是去注释、头文件包含和宏替换，该步骤并不会检查语法。预处理命令为

```shell

$ gcc -E main.c -o main.i
$ ls
main.i main.c
```
预处理完成后，会由.c文件生成一个.i文件。

## 编译

编译步骤完成的功能是将预处理之后的程序转换为汇编语言代码。编译命令如下
```shell
$ gcc -S  main.i -o main.s
$ ls
main.c  main.i  hello.s

```
这一步会将.i文件生成为.s格式的汇编语言代码。在该步骤中会检查语法，如果语法有错误，会在这一步报出来。

## 汇编

汇编就是将汇编语言程序处理成二进制目标文件。其命令如下：

```shell
$ gcc -c hello.s -o hello.o  

\# 或者

$ as hello.s -o hello.o    
```

这两个命令实际是等价的

## 链接

链接是最后一步，即将多个目标文件，或者静态库文件(.a)以及动态库文件(.so)链接成最后的可执行程序的过程。其命令如下：

```
$ gcc -o hello hello.o  

$ ./hello

Hello world!
```



通过以上分析发现，看似简单的一条编译命令，其内部完成的步骤是相当复杂的，能够理解编译器编译的原理，对编程是有相当大的帮助的。当然实际开发过程中，只需要使用以下编译命令一步到位，它完成了以上所有四步命令的所有过程

```shell
$ gcc main.c -o main
```



